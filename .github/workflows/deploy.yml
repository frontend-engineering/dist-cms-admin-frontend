name: Deploy
on:
  push:
jobs:
  deploy:
    runs-on: ubuntu-20.04

    steps:
      - uses: actions/checkout@v3

      - id: my_vars
        run: |
          echo "::set-output name=tar_name::$(date +'%Y-%m-%dT%H.%M.%S')-${{ github.sha }}"

      - run: tar -czf ${{ runner.temp }}/${{ steps.my_vars.outputs.tar_name }}.tar.gz .

      - uses: actions/upload-artifact@v3
        with:
          name: ${{ steps.my_vars.outputs.tar_name }}
          path: ${{ runner.temp }}/${{ steps.my_vars.outputs.tar_name }}.tar.gz

      - run: |
          scp -o StrictHostKeyChecking=no -i ${{ secrets.SERVER_KEY }} ${{ runner.temp }}/${{ steps.my_vars.outputs.tar_name }}.tar.gz ${{ secrets.SERVER_USER }}@${{ secrets.SERVER_HOST }}:~/cms
