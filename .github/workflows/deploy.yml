name: Deploy
on:
  push:
jobs:
  deploy:
    runs-on: ubuntu-20.04

    steps:
      - uses: actions/checkout@v3

      - id: my_vars
        run: |
          echo "::set-output name=tar_name::$(date +'%Y-%m-%dT%H.%M.%S')-${{ github.sha }}"

      - run: tar -czf ${{ runner.temp }}/${{ steps.my_vars.outputs.tar_name }}.tar.gz .

      - uses: actions/upload-artifact@v3
        with:
          name: ${{ steps.my_vars.outputs.tar_name }}
          path: ${{ runner.temp }}/${{ steps.my_vars.outputs.tar_name }}.tar.gz

      - uses: appleboy/scp-action@master
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SERVER_KEY }}
          source: ${{ runner.temp }}/${{ steps.my_vars.outputs.tar_name }}.tar.gz
          target: "$HOME/cms"
